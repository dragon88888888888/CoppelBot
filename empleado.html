<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Coppel App - Empleado</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#005AA3" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        #map {
            width: 100%;
            height: 400px;
            position: relative;
        }
        .control-panel {
            position: absolute;
            top: 20px;
            right: -340px; /* Hidden by default */
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.15);
            width: 320px;
            max-height: 90vh;
            overflow-y: auto;
            transition: right 0.3s ease-in-out;
        }
        .control-panel.open {
            right: 20px; /* Visible when open */
        }
        .control-panel:hover {
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        .business-info {
            max-height: 250px;
            overflow-y: auto;
            font-size: 14px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .custom-icon {
            background: #fff;
            border: 2px solid #333;
            border-radius: 50%;
            text-align: center;
            line-height: 32px;
            font-weight: bold;
            box-shadow: 0 0 8px rgba(0,0,0,0.15);
        }
        .filter-section {
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid #eee;
        }
        .btn-coppel {
            background-color: #00a0e3;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            width: 100%;
            margin: 8px 0;
            transition: background-color 0.2s ease;
        }
        .btn-coppel:hover {
            background-color: #0088c7;
        }
        .btn-coppel:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .user-location {
            background-color: #2ecc71;
        }
        .user-location:hover {
            background-color: #27ae60;
        }
        .legend {
            background: white;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 1px 8px rgba(0,0,0,0.1);
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .legend-icon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 1px solid #333;
        }
        select, input {
            width: 100%;
            padding: 8px;
            margin-top: 6px;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-size: 14px;
        }
        h3 {
            margin: 0 0 15px;
            color: #00a0e3;
            font-size: 20px;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 12px;
        }
        .spinner {
            border: 4px solid rgba(0,0,0,0.1);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border-left-color: #00a0e3;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .hamburger-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1001;
            background: #005AA3;
            color: #FFD700;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 20px;
            transition: background-color 0.2s ease;
        }
        .hamburger-btn:hover {
            background-color: #004080;
        }
        @media (max-width: 768px) {
            .control-panel {
                width: 90%;
                max-width: 300px;
                right: -320px; /* Hidden for mobile */
            }
            .control-panel.open {
                right: 5%;
                transform: translateX(0);
            }
            .hamburger-btn {
                top: 5px;
                right: 5px;
            }
        }
    </style>
  </head>
  <body>
    <div class="iphone-container">
      <div class="iphone-notch"></div>
      <div class="iphone-screen">
        <header class="app-header">
          <img src="icons/Coppel logo.png" alt="Coppel Logo" class="logo" />
          <div class="user-info">
            <span id="user-email"></span>
            <button class="logout-btn" id="logout-btn">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="#FFD700"
              >
                <path
                  d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"
                />
              </svg>
            </button>
          </div>
        </header>

        <nav class="bottom-nav">
          <button class="nav-btn active" data-section="registros">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="#FFD700"
            >
              <path
                d="M4 13h6c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1zm0 8h6c.55 0 1-.45 1-1v-8c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1zm10 0h6c.55 0 1-.45 1-1v-8c0-.55-.45-1-1-1h-6c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1zM13 4v8c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1h-6c-.55 0-1 .45-1 1z"
              />
            </svg>
            <span>Registros</span>
          </button>
          <button class="nav-btn" data-section="rutas">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="#FFD700"
            >
              <path
                d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"
              />
            </svg>
            <span>Rutas</span>
          </button>
          <button class="nav-btn" id="voice-assistant-btn" data-section="asistente">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="#FFD700"
            >
              <path
                d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"
              />
            </svg>
            <span>Asistente</span>
          </button>
        </nav>

        <main class="dashboard-container">
          <!-- Sección Registros -->
          <section id="registros-section" class="dashboard-section active">
            <h2 class="slide-in-left">Registro de Microempresarios</h2>
            <div class="search-bar focus-in-expand">
              <input type="text" placeholder="Buscar microempresario..." />
              <button class="search-btn">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="#005AA3"
                >
                  <path
                    d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                  />
                </svg>
              </button>
            </div>

            <div class="microempresarios-list">
              <div class="microempresario-card slide-in-right" data-id="1">
                <div class="microempresario-avatar">JL</div>
                <div class="microempresario-info">
                  <h3>Juan López Martínez</h3>
                  <p>Miscelánea "La Económica"</p>
                  <span class="microempresario-status active">Activo</span>
                </div>
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="#005AA3"
                  class="arrow-icon"
                >
                  <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />
                </svg>
              </div>

              <div
                class="microempresario-card slide-in-right"
                data-id="2"
                style="animation-delay: 0.1s"
              >
                <div class="microempresario-avatar">MG</div>
                <div class="microempresario-info">
                  <h3>María González Pérez</h3>
                  <p>Tortillería "La Abuelita"</p>
                  <span class="microempresario-status pending">Pendiente</span>
                </div>
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="#005AA3"
                  class="arrow-icon"
                >
                  <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />
                </svg>
              </div>

              <div
                class="microempresario-card slide-in-right"
                data-id="3"
                style="animation-delay: 0.2s"
              >
                <div class="microempresario-avatar">RS</div>
                <div class="microempresario-info">
                  <h3>Roberto Sánchez Díaz</h3>
                  <p>Taller mecánico "El Veloz"</p>
                  <span class="microempresario-status inactive">Inactivo</span>
                </div>
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="#005AA3"
                  class="arrow-icon"
                >
                  <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />
                </svg>
              </div>

              <div
                class="microempresario-card slide-in-right"
                data-id="4"
                style="animation-delay: 0.3s"
              >
                <div class="microempresario-avatar">AC</div>
                <div class="microempresario-info">
                  <h3>Ana Cristina Ruiz</h3>
                  <p>Boutique "Moda Elegante"</p>
                  <span class="microempresario-status active">Activo</span>
                </div>
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="#005AA3"
                  class="arrow-icon"
                >
                  <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />
                </svg>
              </div>
            </div>

            <!-- Modal de detalles -->
            <div id="microempresario-modal" class="modal">
              <div class="modal-content slide-in-bck-center">
                <div class="modal-header">
                  <h2 id="modal-title">Detalles del Microempresario</h2>
                  <span class="close-modal">×</span>
                </div>
                <div class="modal-body" id="modal-body">
                  <!-- Contenido dinámico -->
                </div>
              </div>
            </div>
          </section>

          <!-- Sección Rutas -->
          <section id="rutas-section" class="dashboard-section">
            <h2 class="slide-in-left">Rutas de cobro</h2>
            <div class="map-container" id="map">
              <button class="hamburger-btn" id="hamburger-btn">
                <i class="fas fa-bars"></i>
              </button>
              <div class="control-panel" id="control-panel">
                <h3><i class="bi bi-geo-alt-fill"></i> Mapa Microempresarios</h3>
                <div class="filter-section">
                  <label for="business-type">Filtrar por tipo:</label>
                  <select id="business-type">
                    <option value="all">Todos los tipos</option>
                    <option value="comida">Comida</option>
                    <option value="ropa">Ropa</option>
                    <option value="servicios">Servicios</option>
                    <option value="tecnologia">Tecnología</option>
                    <option value="otros">Otros</option>
                  </select>
                </div>
                <div class="filter-section">
                  <label for="search-radius">Radio de búsqueda (km):</label>
                  <input type="range" id="search-radius" min="1" max="50" value="10">
                  <span id="radius-value">10 km</span>
                </div>
                <div class="filter-section">
                  <button id="locate-me" class="btn-coppel user-location">
                    <i class="bi bi-geo-fill"></i> Mi ubicación
                  </button>
                  <div class="loading" id="location-loading">
                    <div class="spinner"></div>
                    <p>Buscando ubicación...</p>
                  </div>
                </div>
                <div class="filter-section">
                  <button id="exportPdf" class="btn-coppel">
                    <i class="bi bi-file-earmark-pdf"></i> Exportar a PDF
                  </button>
                </div>
                <div class="legend">
                  <h4><i class="bi bi-list-ul"></i> Leyenda</h4>
                  <div class="legend-item"><div class="legend-icon" style="background-color: #e74c3c;"><i class="fas fa-utensils"></i></div> Comida</div>
                  <div class="legend-item"><div class="legend-icon" style="background-color: #3498db;"><i class="fas fa-tshirt"></i></div> Ropa</div>
                  <div class="legend-item"><div class="legend-icon" style="background-color: #2ecc71;"><i class="fas fa-tools"></i></div> Servicios</div>
                  <div class="legend-item"><div class="legend-icon" style="background-color: #9b59b6;"><i class="fas fa-laptop"></i></div> Tecnología</div>
                  <div class="legend-item"><div class="legend-icon" style="background-color: #f39c12;"><i class="fas fa-store"></i></div> Otros</div>
                  <div class="legend-item"><div class="legend-icon" style="background-color: #2c3e50;"><i class="bi bi-geo-fill"></i></div> Tu ubicación</div>
                </div>
              </div>
            </div>
            <div class="route-info swing-in-top-fwd">
              <h3>Ruta del día</h3>
              <div class="route-steps">
                <div class="route-step active">
                  <span class="step-number">1</span>
                  <div class="step-info">
                    <h4>Miscelánea "La Económica"</h4>
                    <p>Juan López Martínez</p>
                    <p>Calle Falsa 123, Col. Centro</p>
                  </div>
                  <span class="step-status">Pendiente</span>
                </div>

                <div class="route-step">
                  <span class="step-number">2</span>
                  <div class="step-info">
                    <h4>Tortillería "La Abuelita"</h4>
                    <p>María González Pérez</p>
                    <p>Av. Siempre Viva 742</p>
                  </div>
                  <span class="step-status">Pendiente</span>
                </div>

                <div class="route-step">
                  <span class="step-number">3</span>
                  <div class="step-info">
                    <h4>Taller mecánico "El Veloz"</h4>
                    <p>Roberto Sánchez Díaz</p>
                    <p>Blvd. Las Flores 456</p>
                  </div>
                  <span class="step-status">Pendiente</span>
                </div>
              </div>
            </div>
          </section>

          <!-- Sección Asistente -->
          <section id="asistente-section" class="dashboard-section">
            <h2 class="slide-in-left">Asistente de Voz</h2>
            <div class="voice-assistant-wrapper">
              <div class="voice-mic-container">
                <button class="voice-mic-button" id="mic-button">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="#FFD700"
                  >
                    <path
                      d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"
                    />
                  </svg>
                </button>
                <div class="pulse-rings">
                  <div class="pulse-ring"></div>
                  <div class="pulse-ring"></div>
                  <div class="pulse-ring"></div>
                </div>
              </div>

              <div class="voice-result-container" id="voice-result">
                <div class="voice-result-text" id="voice-result-text">
                  Presiona el micrófono para hablar
                </div>
              </div>

              <p class="voice-instructions">
                Puedes utilizar comandos de voz para navegar o realizar
                acciones en la aplicación
              </p>

              <div class="voice-commands">
                <div class="voice-command-item">
                  <div class="voice-command-icon">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24"
                    >
                      <path
                        d="M4 13h6c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1zm0 8h6c.55 0 1-.45 1-1v-8c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1zm10 0h6c.55 0 1-.45 1-1v-8c0-.55-.45-1-1-1h-6c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1zM13 4v8c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1h-6c-.55 0-1 .45-1 1z"
                      />
                    </svg>
                  </div>
                  <div class="voice-command-text">
                    "Registros", "Rutas"
                  </div>
                </div>

                <div class="voice-command-item">
                  <div class="voice-command-icon">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24"
                    >
                      <path
                        d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                      />
                    </svg>
                  </div>
                  <div class="voice-command-text">
                    "Buscar [nombre o término]"
                  </div>
                </div>

                <div class="voice-command-item">
                  <div class="voice-command-icon">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24"
                    >
                      <path
                        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"
                      />
                    </svg>
                  </div>
                  <div class="voice-command-text">
                    "Ayuda", "¿Qué puedes hacer?"
                  </div>
                </div>
              </div>
            </div>
          </section>
        </main>
      </div>
      <div class="iphone-home-button"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="js/app.js"></script>
    <script src="js/agents.js"></script>
    <script src="js/empleado.js"></script>
  </body>
</html>